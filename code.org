
#+PROPERTY: header-args:jupyter-python+ :session boreholes :kernel ds

* overview.bsv from meta.bsvs

#+BEGIN_SRC jupyter-python
import glob
import pandas as pd

ms = sort(glob.glob("*/meta.bsv"))
df = pd.DataFrame()

for am in ms:
  if 'template' in am: continue
  m = pd.read_csv(am, sep="|", index_col=0).squeeze()
  if df.size == 0:
    df[m.name] = m
  else:
    df = df.merge(m, left_index=True, right_index=True)

df = df.T
df.index.name = 'Site'

# coverage
df['Coverage [% of thickness]'] = np.round((df['Depth of bottom measurement [m]'].astype(np.float) - df['Depth of top measurement [m]'].astype(np.float)) / pd.to_numeric(df['Ice thickness [m]'], errors='coerce').astype(np.float) * 100).replace(np.nan,0).astype(np.int)

df.to_csv("overview.bsv", sep="|")
#+END_SRC

#+RESULTS:

* Combine all temperature profiles


* Code                                                  :noexport:
#+NAME: init
#+BEGIN_SRC jupyter-python
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

import matplotlib
from matplotlib import rc
rc('font', size=12)
rc('text', usetex=False)
# matplotlib.pyplot.xkcd()
#+END_SRC

#+NAME: fig_setup
#+BEGIN_SRC jupyter-python
# plt.close(1)
fig = plt.figure(1, figsize=(5,4)) # w,h
# get_current_fig_manager().window.move(0,0)
fig.clf()
fig.set_tight_layout(True)
# import matplotlib.gridspec as gridspec
# gs = gridspec.GridSpec(1, 1) #w,h
# ax = plt.subplot(gs[:,:])
ax = fig.add_subplot(111)

# ax.plot(np.sin(np.arange(0,2*pi,0.1)))
# plt.savefig('.png', transparent=True, bbox_inches='tight', dpi=300)
#+END_SRC

#+name: extract_site_from_overview
#+BEGIN_SRC jupyter-python :noweb-ref extract_site_from_overview
import pandas as pd
df = pd.read_csv('../borehole_temperature.csv', sep='|', index_col=1)
df = pd.DataFrame(df.loc[site])
df.loc['Data source'] = df.loc['Data source'].values.astype('<U30')
df
#+END_SRC
